<!DOCTYPE html>
<html>
<head>
  <title>Classroom App</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script>
    async function updateStudents() {
      const teacherId = document.getElementById("teacherSelect").value;
      const studentSelect = document.getElementById("studentSelect");

      studentSelect.innerHTML = "";

      if (!teacherId) return;

      try {
        const res = await fetch(`/api/students/${teacherId}`);
        const students = await res.json();

        if (students.length === 0) {
          const opt = document.createElement("option");
          opt.text = "No students found";
          opt.disabled = true;
          studentSelect.add(opt);
        } else {
          students.forEach(s => {
            const opt = document.createElement("option");
            opt.value = s.studentID;
            opt.text = s.studentName;
            studentSelect.add(opt);
          });
        }
      } catch (err) {
        console.error("Error fetching students:", err);
      }
    }
  </script>


</head>
<body class="container mt-4">

  <h1 class="mb-4">Welcome to the Classroom App</h1>

  <!-- Teacher & Student Dropdown -->
  <h3>Student Access</h3>
  <form action="/student-code" method="POST" class="mb-4">
    <div class="mb-3">
      <label for="teacherSelect" class="form-label">Choose a Teacher</label>
      <select id="teacherSelect" class="form-select mb-3" onchange="updateStudents()" required>
        <option value="" disabled selected>Select a teacher</option>
        <% teachers.forEach(function(teacher) { %>
          <option value="<%= teacher.teacherID %>"><%= teacher.teacherName %> (<%= teacher.schoolName || "No School" %>)</option>
        <% }) %>
      </select>
    </div>

    <div class="mb-3">
      <label for="studentSelect" class="form-label">Choose a Student</label>
      <select id="studentSelect" name="studentId" class="form-select mb-3" required>
        <option value="" disabled selected>Select a student</option>
      </select>
    </div>

    <div class="mb-3">
      <label for="code" class="form-label">Enter Code</label>
      <input type="text" id="code" name="code" maxlength="5" required class="form-control">
    </div>

    <button type="submit" class="btn btn-primary">Enter</button>
  </form>


</body>
</html>
